<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartStock - × ×™×”×•×œ ×¢×¡×§</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2897/2897785.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .nav-pills .nav-link { color: rgba(255,255,255,0.8); border-radius: 50px; padding: 8px 20px; margin-left: 10px; font-weight: 500; transition: all 0.3s; }
        .nav-pills .nav-link:hover { background-color: rgba(255,255,255,0.2); color: white; }
        .nav-pills .nav-link.active { background-color: white; color: #0d6efd; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .auth-card { max-width: 400px; margin: 60px auto; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .stat-card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: transform 0.2s; background: white; padding: 20px; height: 100%; }
        .stat-card:hover { transform: translateY(-5px); }
        .business-logo { max-height: 40px; margin-left: 10px; border-radius: 5px; }
        .chart-container { position: relative; height: 250px; width: 100%; }
        .badge-cat { background-color: #e7f1ff; color: #0c63e4; border: 1px solid #b6d4fe; }
        .badge-sup { background-color: #f8f9fa; color: #6c757d; border: 1px solid #dee2e6; }
        .link-text { cursor: pointer; color: #0d6efd; text-decoration: underline; }
    </style>
</head>
<body>

    <div class="container" id="login-section">
        <div class="card auth-card bg-white">
            <h2 class="text-center mb-4 text-primary fw-bold"><i class="fas fa-cubes"></i> SmartStock</h2>
            <h5 class="text-center mb-4">×›× ×™×¡×” ×œ××¢×¨×›×ª</h5>
            <div class="mb-3"><label class="form-label">××™××™×™×œ</label><input type="email" id="login-email" class="form-control"></div>
            <div class="mb-3"><label class="form-label">×¡×™×¡××”</label><input type="password" id="login-password" class="form-control"></div>
            <button class="btn btn-primary w-100 py-2 fw-bold" onclick="login()">×”×ª×—×‘×¨</button>
            <div class="text-center mt-3"><small>××™×Ÿ ×œ×š ×—×©×‘×•×Ÿ? <span class="link-text" onclick="showRegister()">×”×™×¨×©× ×›××Ÿ</span></small></div>
            <p id="login-msg" class="text-danger text-center mt-3 fw-bold"></p>
        </div>
    </div>

    <div class="container d-none" id="register-section">
        <div class="card auth-card bg-white">
            <h2 class="text-center mb-4 text-success fw-bold"><i class="fas fa-user-plus"></i> ×”×¨×©××”</h2>
            <div class="mb-3"><label class="form-label">×©× ×”×¢×¡×§</label><input type="text" id="reg-business" class="form-control"></div>
            <div class="mb-3"><label class="form-label">××™××™×™×œ</label><input type="email" id="reg-email" class="form-control"></div>
            <div class="mb-3"><label class="form-label">×¡×™×¡××”</label><input type="password" id="reg-password" class="form-control"></div>
            <button class="btn btn-success w-100 py-2 fw-bold" onclick="register()">×¦×•×¨ ×—×©×‘×•×Ÿ</button>
            <div class="text-center mt-3"><small>×›×‘×¨ ×™×© ×œ×š ×—×©×‘×•×Ÿ? <span class="link-text" onclick="showLogin()">×”×ª×—×‘×¨ ×›××Ÿ</span></small></div>
            <p id="reg-msg" class="text-center mt-3 fw-bold"></p>
        </div>
    </div>

    <div class="d-none" id="main-app">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm mb-4 py-3">
            <div class="container">
                <a class="navbar-brand fw-bold d-flex align-items-center" href="#">
                    <img id="nav-logo-img" src="" class="d-none business-logo bg-white p-1">
                    <span id="nav-business-name"><i class="fas fa-cubes"></i> SmartStock</span>
                </a>
                <div class="collapse navbar-collapse justify-content-center">
                    <ul class="nav nav-pills" id="mainNav">
                        <li class="nav-item"><a class="nav-link active" id="nav-dashboard" onclick="switchTab('dashboard')"><i class="fas fa-chart-line"></i> ×“×©×‘×•×¨×“</a></li>
                        <li class="nav-item"><a class="nav-link" id="nav-profile" onclick="switchTab('profile')"><i class="fas fa-store"></i> ×¤×¨×•×¤×™×œ ×¢×¡×§</a></li>
                    </ul>
                </div>
                <button class="btn btn-outline-light btn-sm fw-bold" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ×™×¦×™××”</button>
            </div>
        </nav>

        <div class="container pb-5">
            <div id="dashboard-section">
                <div class="row g-3 mb-4">
                    <div class="col-md-4"><div class="stat-card"><div class="d-flex justify-content-between align-items-center"><div><h6 class="text-muted">×¡×”"×› ××•×¦×¨×™×</h6><h3 class="fw-bold mb-0" id="stat-total-items">0</h3></div><div class="icon-box text-primary fs-2"><i class="fas fa-boxes"></i></div></div></div></div>
                    <div class="col-md-4"><div class="stat-card"><div class="d-flex justify-content-between align-items-center"><div><h6 class="text-muted">×©×•×•×™ ××œ××™</h6><h3 class="fw-bold mb-0 text-success" id="stat-total-value">â‚ª0</h3></div><div class="icon-box text-success fs-2"><i class="fas fa-coins"></i></div></div></div></div>
                    <div class="col-md-4"><div class="stat-card"><div class="d-flex justify-content-between align-items-center"><div><h6 class="text-muted">×œ×”×–×× ×” ×“×—×•×¤×”</h6><h3 class="fw-bold mb-0 text-danger" id="stat-low-stock">0</h3></div><div class="icon-box text-danger fs-2"><i class="fas fa-exclamation-circle"></i></div></div></div></div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-lg-4"><div class="stat-card"><h6 class="fw-bold mb-3 text-center">×”×ª×¤×œ×’×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª</h6><div class="chart-container"><canvas id="chartCategories"></canvas></div></div></div>
                    <div class="col-lg-4"><div class="stat-card"><h6 class="fw-bold mb-3 text-center">×¡×¤×§×™× ××•×‘×™×œ×™×</h6><div class="chart-container"><canvas id="chartSuppliers"></canvas></div></div></div>
                    <div class="col-lg-4"><div class="stat-card"><h6 class="fw-bold mb-3 text-center">×¢×¨×š ××œ××™ ×œ×¤×™ ×§×˜×’×•×¨×™×”</h6><div class="chart-container"><canvas id="chartValue"></canvas></div></div></div>
                </div>

                <div class="card stat-card p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                        <h5 class="fw-bold mb-0">ğŸ“¦ × ×™×”×•×œ ××œ××™</h5>
                        <div class="d-flex gap-2">
                            <button class="btn btn-success btn-sm" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> ×™×™×¦×•× ×œ××§×¡×œ</button>
                            <div class="vr"></div>
                            <button class="btn btn-outline-secondary btn-sm" onclick="openCategoriesModal()"><i class="fas fa-tags"></i> ×§×˜×’×•×¨×™×•×ª</button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="openSuppliersModal()"><i class="fas fa-truck"></i> ×¡×¤×§×™×</button>
                            <button class="btn btn-primary btn-sm" onclick="openAddModal()"><i class="fas fa-plus"></i> ×”×•×¡×£ ××•×¦×¨</button>
                        </div>
                    </div>
                    <input type="text" id="searchInput" class="form-control mb-3 bg-light border-0" placeholder="ğŸ” ×—×¤×© ××•×¦×¨ ×œ×¤×™ ×©× ××• ××§×´×˜..." onkeyup="filterProducts()">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle" id="inventoryTable">
                            <thead class="table-light"><tr><th>×©× ××•×¦×¨</th><th>×§×˜×’×•×¨×™×” ×•×¡×¤×§</th><th>××—×™×¨</th><th>×›××•×ª</th><th>×¤×¢×•×œ×•×ª</th></tr></thead>
                            <tbody id="products-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="profile-section" class="d-none">
                <div class="card stat-card p-5 mx-auto" style="max-width: 800px;">
                    <h3 class="fw-bold mb-4 text-primary"><i class="fas fa-store"></i> ×”×’×“×¨×•×ª ×¢×¡×§</h3>
                    <div class="row g-3">
                        <div class="col-md-6"><label class="form-label">×©× ×”×¢×¡×§</label><input type="text" id="prof-name" class="form-control"></div>
                        <div class="col-md-6"><label class="form-label">×—.×¤ / ×¢×•×¡×§</label><input type="text" id="prof-id" class="form-control"></div>
                        <div class="col-md-6"><label class="form-label">×˜×œ×¤×•×Ÿ</label><input type="text" id="prof-phone" class="form-control"></div>
                        <div class="col-md-6"><label class="form-label">×›×ª×•×‘×ª</label><input type="text" id="prof-address" class="form-control"></div>
                        <div class="col-12">
                            <label class="form-label">×œ×•×’×• ×”×¢×¡×§</label>
                            <div class="d-flex align-items-center gap-3">
                                <input type="file" id="prof-file-input" class="form-control" accept="image/*" onchange="handleLogoUpload()">
                                <input type="hidden" id="prof-logo-data">
                            </div>
                            <div class="mt-3 text-center p-3 bg-light rounded">
                                <img id="logo-preview" src="" class="d-none" style="max-height: 100px; border-radius: 8px;">
                                <span id="no-logo-text" class="text-muted small">××™×Ÿ ×œ×•×’×• ×›×¨×’×¢</span>
                            </div>
                        </div>
                    </div>
                    <hr class="my-4">
                    <button class="btn btn-primary btn-lg w-100" onclick="saveProfile()"><i class="fas fa-save"></i> ×©××•×¨ ×©×™× ×•×™×™×</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="productModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">××•×¦×¨</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="p-id"><input type="text" id="p-name" class="form-control mb-2" placeholder="×©× ×”××•×¦×¨"><div class="row g-2 mb-2"><div class="col-6"><label class="small text-muted">×§×˜×’×•×¨×™×”</label><select id="p-category" class="form-select"><option value="">×‘×—×¨...</option></select></div><div class="col-6"><label class="small text-muted">×¡×¤×§</label><select id="p-supplier" class="form-select"><option value="">×‘×—×¨...</option></select></div></div><input type="text" id="p-sku" class="form-control mb-2" placeholder="××§×´×˜"><div class="row"><div class="col"><input type="number" id="p-qty" class="form-control" placeholder="×›××•×ª"></div><div class="col"><input type="number" id="p-price" class="form-control" placeholder="××—×™×¨"></div></div></div><div class="modal-footer"><button class="btn btn-primary" onclick="saveProduct()">×©××•×¨</button></div></div></div></div>
    <div class="modal fade" id="categoriesModal" tabindex="-1"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">×§×˜×’×•×¨×™×•×ª</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="input-group mb-3"><input type="text" id="new-cat-name" class="form-control" placeholder="×©×"><button class="btn btn-success" onclick="addCategory()"><i class="fas fa-plus"></i></button></div><ul class="list-group list-group-flush" id="categories-list-manage"></ul></div></div></div></div>
    <div class="modal fade" id="suppliersModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">×¡×¤×§×™×</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="mb-3 border-bottom pb-3"><input type="text" id="new-sup-name" class="form-control mb-2" placeholder="×©× ×”×¡×¤×§"><input type="text" id="new-sup-phone" class="form-control mb-2" placeholder="×˜×œ×¤×•×Ÿ"><button class="btn btn-success w-100" onclick="addSupplier()">×”×•×¡×£</button></div><h6>×¨×©×™××”:</h6><ul class="list-group list-group-flush" id="suppliers-list-manage"></ul></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --------------- ×©×™× ×œ×‘: ×›××Ÿ ××ª×” ××“×‘×™×§ ××ª ×”×›×ª×•×‘×ª ××¨× ×“×¨ ----------------
        const API_URL = "https://smartstock-mag6.onrender.com/"; 
        // ------------------------------------------------------------------------

        let token = localStorage.getItem('token');
        let allProducts=[], allCategories=[], allSuppliers=[], charts={cat:null,sup:null,val:null};

        if (token) initApp();

        function showRegister() { document.getElementById('login-section').classList.add('d-none'); document.getElementById('register-section').classList.remove('d-none'); }
        function showLogin() { document.getElementById('register-section').classList.add('d-none'); document.getElementById('login-section').classList.remove('d-none'); }
        async function register() {
            const body = JSON.stringify({ email: document.getElementById('reg-email').value, password: document.getElementById('reg-password').value, business_name: document.getElementById('reg-business').value });
            const res = await fetch(`${API_URL}/register`, { method:'POST', headers:{'Content-Type':'application/json'}, body });
            const msg = document.getElementById('reg-msg');
            if (res.ok) { msg.innerText = "× ×¨×©××ª ×‘×”×¦×œ×—×”! ×‘×“×•×§ ××™×™×œ."; msg.className="text-center mt-3 text-success fw-bold"; }
            else { msg.innerText = (await res.json()).error; msg.className="text-center mt-3 text-danger fw-bold"; }
        }
        async function login() {
            const body = JSON.stringify({ email: document.getElementById('login-email').value, password: document.getElementById('login-password').value });
            const res = await fetch(`${API_URL}/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body });
            const data = await res.json();
            if (res.ok) { localStorage.setItem('token', data.access_token); token = data.access_token; initApp(); }
            else { document.getElementById('login-msg').innerText = data.error; }
        }
        function logout() { localStorage.removeItem('token'); location.reload(); }

        async function initApp() {
            document.getElementById('login-section').classList.add('d-none'); document.getElementById('register-section').classList.add('d-none');
            document.getElementById('main-app').classList.remove('d-none');
            await loadProfile();
            await Promise.all([loadCategories(), loadSuppliers()]);
            await loadProducts();
        }

        function exportToExcel() {
            const dataForExcel = allProducts.map(p => {
                const cat = allCategories.find(c => c.id === p.category_id)?.name || '×œ×œ×';
                const sup = allSuppliers.find(s => s.id === p.supplier_id)?.name || '×œ×œ×';
                return { "×©× ××•×¦×¨": p.name, "××§×´×˜": p.sku, "×§×˜×’×•×¨×™×”": cat, "×¡×¤×§": sup, "×›××•×ª": p.quantity, "××—×™×¨ ××›×™×¨×”": p.sell_price, "×©×•×•×™ ××œ××™": p.quantity * p.sell_price };
            });
            const ws = XLSX.utils.json_to_sheet(dataForExcel);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Inventory");
            XLSX.writeFile(wb, "SmartStock_Inventory.xlsx");
        }

        function switchTab(tab) {
            document.getElementById('dashboard-section').classList.add('d-none'); document.getElementById('profile-section').classList.add('d-none');
            document.getElementById('nav-dashboard').classList.remove('active'); document.getElementById('nav-profile').classList.remove('active');
            document.getElementById(tab+'-section').classList.remove('d-none'); document.getElementById('nav-'+tab).classList.add('active');
        }

        function handleLogoUpload() {
            const fileInput = document.getElementById('prof-file-input');
            const file = fileInput.files[0];
            if (file) {
                if (file.size > 100000) { alert("×”×§×•×‘×¥ ×’×“×•×œ ××“×™! ×‘×—×¨ ×ª××•× ×” ×§×˜× ×” ×-100KB"); fileInput.value = ""; return; }
                const reader = new FileReader();
                reader.onloadend = function() {
                    document.getElementById('prof-logo-data').value = reader.result;
                    const img = document.getElementById('logo-preview');
                    img.src = reader.result;
                    img.classList.remove('d-none');
                    document.getElementById('no-logo-text').classList.add('d-none');
                }
                reader.readAsDataURL(file);
            }
        }

        async function loadCategories() { const res = await fetch(`${API_URL}/categories`, { headers: {'Authorization':token} }); if(res.ok) { allCategories=await res.json(); renderOptions('p-category', allCategories); renderCategoriesManageList(); }}
        async function loadSuppliers() { const res = await fetch(`${API_URL}/suppliers`, { headers: {'Authorization':token} }); if(res.ok) { allSuppliers=await res.json(); renderOptions('p-supplier', allSuppliers); renderSuppliersManageList(); }}
        async function loadProducts() { const res = await fetch(`${API_URL}/products`, { headers: {'Authorization':token} }); allProducts=await res.json(); updateStats(allProducts); renderTable(allProducts); }
        async function loadProfile() { 
            const res = await fetch(`${API_URL}/profile`, { headers: {'Authorization':token} }); 
            if(res.ok) { 
                const d=await res.json(); document.getElementById('prof-name').value=d.business_name||''; document.getElementById('prof-id').value=d.company_id||''; document.getElementById('prof-phone').value=d.phone||''; document.getElementById('prof-address').value=d.address||'';
                if (d.logo_url) { document.getElementById('prof-logo-data').value = d.logo_url; document.getElementById('logo-preview').src = d.logo_url; document.getElementById('logo-preview').classList.remove('d-none'); document.getElementById('no-logo-text').classList.add('d-none'); updateNavbarLogo(d.business_name, d.logo_url); } else { updateNavbarLogo(d.business_name, null); }
            }
        }

        function renderOptions(elmId, items) { document.getElementById(elmId).innerHTML = '<option value="">×‘×—×¨...</option>' + items.map(i=>`<option value="${i.id}">${i.name}</option>`).join(''); }
        function renderTable(products) {
            document.getElementById('products-list').innerHTML = products.map(p => {
                const cat = allCategories.find(c => c.id === p.category_id);
                const sup = allSuppliers.find(s => s.id === p.supplier_id);
                return `<tr class="${p.quantity <= p.reorder_level ? 'table-warning' : ''}"><td><strong>${p.name}</strong><br><small class="text-muted">${p.sku}</small></td><td>${cat?`<span class="badge badge-cat">${cat.name}</span>`:''} ${sup?`<span class="badge badge-sup"><i class="fas fa-truck-moving small"></i> ${sup.name}</span>`:''}</td><td>â‚ª${p.sell_price}</td><td>${p.quantity}</td><td><i class="fas fa-pen mx-2" style="cursor:pointer" onclick="openEditModal(${p.id})"></i><i class="fas fa-trash mx-2" style="cursor:pointer" onclick="deleteProduct(${p.id})"></i></td></tr>`;
            }).join('');
        }
        function updateNavbarLogo(name,url) { if(name)document.getElementById('nav-business-name').innerText=name; const img=document.getElementById('nav-logo-img'); if(url){img.src=url;img.classList.remove('d-none');document.getElementById('nav-business-name').innerText="";}else{img.classList.add('d-none');document.getElementById('nav-business-name').innerText="SmartStock";} }

        function updateStats(products) {
            document.getElementById('stat-total-items').innerText = products.length;
            document.getElementById('stat-total-value').innerText = "â‚ª" + products.reduce((s, p) => s + (p.quantity * p.sell_price), 0).toLocaleString();
            document.getElementById('stat-low-stock').innerText = products.filter(p => p.quantity <= p.reorder_level).length;
            const catCounts = {}, supCounts = {}, catValues = {};
            products.forEach(p => {
                const cName = allCategories.find(c => c.id === p.category_id)?.name || '××—×¨';
                const sName = allSuppliers.find(s => s.id === p.supplier_id)?.name || '××—×¨';
                catCounts[cName] = (catCounts[cName]||0) + p.quantity;
                supCounts[sName] = (supCounts[sName]||0) + p.quantity;
                catValues[cName] = (catValues[cName]||0) + (p.quantity * p.sell_price);
            });
            const colors = ['#0d6efd', '#6610f2', '#6f42c1', '#d63384', '#dc3545', '#fd7e14', '#ffc107', '#198754', '#20c997', '#0dcaf0'];
            drawChart('chartCategories', 'doughnut', Object.keys(catCounts), Object.values(catCounts), 'cat', colors);
            drawChart('chartSuppliers', 'bar', Object.keys(supCounts).slice(0,5), Object.values(supCounts).slice(0,5), 'sup', ['#198754']);
            drawChart('chartValue', 'bar', Object.keys(catValues).slice(0,5), Object.values(catValues).slice(0,5), 'val', ['#0dcaf0']);
        }
        function drawChart(canvasId, type, labels, data, chartKey, bgColors) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            if (charts[chartKey]) charts[chartKey].destroy();
            charts[chartKey] = new Chart(ctx, { type: type, data: { labels, datasets: [{ data, backgroundColor: bgColors, borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: type==='doughnut', position:'bottom' } }, scales: type==='bar'?{y:{beginAtZero:true}}:{} } });
        }

        async function saveProfile() { 
            const logoData = document.getElementById('prof-logo-data').value;
            const data={ business_name:document.getElementById('prof-name').value, company_id:document.getElementById('prof-id').value, phone:document.getElementById('prof-phone').value, address:document.getElementById('prof-address').value, logo_url: logoData }; 
            await fetch(`${API_URL}/profile`,{method:'PUT',headers:{'Content-Type':'application/json','Authorization':token},body:JSON.stringify(data)}); 
            alert('×”×¤×¨×•×¤×™×œ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!'); updateNavbarLogo(data.business_name, data.logo_url); 
        }

        async function addCategory(){const n=document.getElementById('new-cat-name').value;if(!n)return;await fetch(`${API_URL}/categories`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':token},body:JSON.stringify({name:n})});document.getElementById('new-cat-name').value='';loadCategories();}
        async function deleteCategory(id){if(confirm('×œ××—×•×§?')){await fetch(`${API_URL}/categories/${id}`,{method:'DELETE',headers:{'Authorization':token}});loadCategories();loadProducts();}}
        function renderCategoriesManageList(){document.getElementById('categories-list-manage').innerHTML=allCategories.map(c=>`<li class="list-group-item d-flex justify-content-between">${c.name}<button class="btn btn-sm text-danger" onclick="deleteCategory(${c.id})"><i class="fas fa-trash"></i></button></li>`).join('');}
        async function addSupplier(){const n=document.getElementById('new-sup-name').value,p=document.getElementById('new-sup-phone').value;if(!n)return;await fetch(`${API_URL}/suppliers`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':token},body:JSON.stringify({name:n,phone:p})});document.getElementById('new-sup-name').value='';loadSuppliers();}
        async function deleteSupplier(id){if(confirm('×œ××—×•×§?')){await fetch(`${API_URL}/suppliers/${id}`,{method:'DELETE',headers:{'Authorization':token}});loadSuppliers();loadProducts();}}
        function renderSuppliersManageList(){document.getElementById('suppliers-list-manage').innerHTML=allSuppliers.map(s=>`<li class="list-group-item d-flex justify-content-between">${s.name}<button class="btn btn-sm text-danger" onclick="deleteSupplier(${s.id})"><i class="fas fa-trash"></i></button></li>`).join('');}
        let pModal;
        function openAddModal(){document.getElementById('p-id').value='';document.getElementById('p-name').value='';document.getElementById('p-category').value='';document.getElementById('p-supplier').value='';pModal=new bootstrap.Modal(document.getElementById('productModal'));pModal.show();}
        function openEditModal(id){const p=allProducts.find(x=>x.id==id);document.getElementById('p-id').value=p.id;document.getElementById('p-name').value=p.name;document.getElementById('p-category').value=p.category_id||'';document.getElementById('p-supplier').value=p.supplier_id||'';document.getElementById('p-sku').value=p.sku;document.getElementById('p-qty').value=p.quantity;document.getElementById('p-price').value=p.sell_price;pModal=new bootstrap.Modal(document.getElementById('productModal'));pModal.show();}
        async function saveProduct(){const id=document.getElementById('p-id').value;const body=JSON.stringify({name:document.getElementById('p-name').value,sku:document.getElementById('p-sku').value,quantity:document.getElementById('p-qty').value,sell_price:document.getElementById('p-price').value,category_id:document.getElementById('p-category').value?parseInt(document.getElementById('p-category').value):null,supplier_id:document.getElementById('p-supplier').value?parseInt(document.getElementById('p-supplier').value):null});await fetch(`${API_URL}/products${id?'/'+id:''}`,{method:id?'PUT':'POST',headers:{'Content-Type':'application/json','Authorization':token},body});pModal.hide();loadProducts();}
        async function deleteProduct(id){if(confirm('×œ××—×•×§?')){await fetch(`${API_URL}/products/${id}`,{method:'DELETE',headers:{'Authorization':token}});loadProducts();}}
        function openCategoriesModal(){new bootstrap.Modal(document.getElementById('categoriesModal')).show();}
        function openSuppliersModal(){new bootstrap.Modal(document.getElementById('suppliersModal')).show();}
        function filterProducts(){renderTable(allProducts.filter(p=>p.name.includes(document.getElementById('searchInput').value)));}
    </script>
</body>
</html>