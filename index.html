<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartStock - ניהול עסק חכם</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --sidebar-width: 250px; }
        body { background-color: var(--bg); font-family: 'Segoe UI', system-ui, sans-serif; padding-bottom: 80px; }
        
        /* Navbar Customization */
        .navbar { background: linear-gradient(135deg, #1e3a8a, #3b82f6); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .nav-link { color: rgba(255,255,255,0.85) !important; font-weight: 500; transition: 0.3s; border-radius: 8px; margin: 0 5px; }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.2); color: white !important; font-weight: bold; }

        /* Cards & UI */
        .stat-card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); height: 100%; transition: transform 0.2s; border: none; }
        .stat-card:hover { transform: translateY(-2px); }
        .chart-container { position: relative; height: 250px; width: 100%; }

        /* Mobile Bottom Nav (Visible only on small screens) */
        .bottom-nav {
            display: none; /* Default hidden */
            position: fixed; bottom: 0; left: 0; right: 0; height: 70px;
            background: white; box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
            justify-content: space-around; align-items: center;
            z-index: 1050; padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-icon { text-align: center; color: #94a3b8; font-size: 0.75rem; cursor: pointer; flex: 1; transition: 0.2s; }
        .nav-icon i { font-size: 1.5rem; display: block; margin-bottom: 4px; }
        .nav-icon.active { color: var(--primary); transform: scale(1.1); font-weight: bold; }

        /* Cart Bar */
        #cart-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #0f172a; color: white; padding: 15px 25px; 
            z-index: 1040; transform: translateY(150%); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 -5px 25px rgba(0,0,0,0.2);
        }
        #cart-bar.visible { transform: translateY(0); }
        
        /* Responsive Adjustments */
        @media (max-width: 991px) { /* Mobile & Tablet */
            .desktop-nav-content { display: none !important; }
            .bottom-nav { display: flex; }
            body { padding-bottom: 90px; } /* Space for bottom nav */
            #cart-bar { bottom: 70px; border-radius: 15px 15px 0 0; }
            .chart-container { height: 200px; }
        }
        @media (min-width: 992px) { /* Desktop */
            .mobile-header { display: none !important; }
        }

        .abc-badge-A { background: #dcfce7; color: #15803d; padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .abc-badge-B { background: #fef9c3; color: #a16207; padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .abc-badge-C { background: #fee2e2; color: #b91c1c; padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .auth-container { max-width: 450px; margin: 80px auto; }
    </style>
</head>
<body>

    <div id="auth-section" class="container auth-container">
        <div class="stat-card p-5 text-center">
            <div class="mb-4 text-primary" style="font-size: 3rem;"><i class="fas fa-cubes"></i></div>
            <h2 class="fw-bold mb-4">SmartStock</h2>
            
            <ul class="nav nav-pills nav-fill mb-4 p-1 bg-light rounded-pill">
                <li class="nav-item"><a class="nav-link rounded-pill active" onclick="toggleAuth('login')" href="#">כניסה</a></li>
                <li class="nav-item"><a class="nav-link rounded-pill" onclick="toggleAuth('register')" href="#">הרשמה</a></li>
            </ul>
            
            <div id="form-login">
                <div class="form-floating mb-3">
                    <input type="email" id="l-email" class="form-control" placeholder="name@example.com">
                    <label>אימייל</label>
                </div>
                <div class="form-floating mb-4">
                    <input type="password" id="l-pass" class="form-control" placeholder="Password">
                    <label>סיסמה</label>
                </div>
                <button class="btn btn-primary w-100 py-3 fw-bold rounded-pill" onclick="login()">התחבר למערכת <i class="fas fa-arrow-left me-2"></i></button>
            </div>
            
            <div id="form-register" class="d-none">
                <div class="form-floating mb-3">
                    <input type="text" id="r-name" class="form-control" placeholder="Business Name">
                    <label>שם העסק</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="email" id="r-email" class="form-control" placeholder="name@example.com">
                    <label>אימייל</label>
                </div>
                <div class="form-floating mb-4">
                    <input type="password" id="r-pass" class="form-control" placeholder="Password">
                    <label>סיסמה</label>
                </div>
                <button class="btn btn-success w-100 py-3 fw-bold rounded-pill" onclick="register()">צור חשבון <i class="fas fa-check me-2"></i></button>
            </div>
            <p id="auth-msg" class="text-center mt-3 fw-bold"></p>
        </div>
    </div>

    <div id="app-section" class="d-none">
        
        <nav class="navbar navbar-expand-lg navbar-dark sticky-top mb-4">
            <div class="container">
                <a class="navbar-brand fw-bold fs-4 d-flex align-items-center gap-2" href="#">
                    <i class="fas fa-cubes"></i> SmartStock
                </a>
                
                <div class="desktop-nav-content d-flex align-items-center">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" onclick="switchTab('dashboard')" id="nav-d-dashboard"><i class="fas fa-home"></i> דשבורד</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('analytics')" id="nav-d-analytics"><i class="fas fa-chart-pie"></i> דוחות AI</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('customers')" id="nav-d-customers"><i class="fas fa-users"></i> לקוחות</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('orders')" id="nav-d-orders"><i class="fas fa-receipt"></i> הזמנות</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('profile')" id="nav-d-profile"><i class="fas fa-cog"></i> הגדרות</a></li>
                    </ul>
                    <button class="btn btn-light text-primary fw-bold ms-3 rounded-pill px-4" onclick="logout()">יציאה</button>
                </div>

                <div class="mobile-header d-lg-none ms-auto text-white">
                    <button class="btn btn-sm text-white" onclick="logout()"><i class="fas fa-sign-out-alt fs-5"></i></button>
                </div>
            </div>
        </nav>

        <div class="container">
            
            <div id="tab-dashboard">
                <div class="row g-3 mb-4">
                    <div class="col-6 col-md-3"><div class="stat-card border-start border-4 border-primary"><div class="text-muted small fw-bold">מכירות היום</div><h3 class="fw-bold m-0 mt-1 text-primary" id="kpi-sales">₪0</h3></div></div>
                    <div class="col-6 col-md-3"><div class="stat-card border-start border-4 border-success"><div class="text-muted
