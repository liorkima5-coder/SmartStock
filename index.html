<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartStock - × ×™×”×•×œ ×¢×¡×§ ×—×›×</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2897/2897785.png" type="image/png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --sidebar-width: 250px; }
        body { background-color: var(--bg); font-family: 'Segoe UI', system-ui, sans-serif; padding-bottom: 80px; min-height: 100vh; display: flex; flex-direction: column;}
        
        /* Navbar Customization */
        .navbar { background: linear-gradient(135deg, #1e3a8a, #3b82f6); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .nav-link { color: rgba(255,255,255,0.85) !important; font-weight: 500; transition: 0.3s; border-radius: 8px; margin: 0 5px; }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.2); color: white !important; font-weight: bold; }

        /* Cards & UI */
        .stat-card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); height: 100%; transition: transform 0.2s; border: none; }
        .stat-card:hover { transform: translateY(-2px); }
        .chart-container { position: relative; height: 250px; width: 100%; }

        /* Mobile Bottom Nav (Visible only on small screens) */
        .bottom-nav {
            display: none; /* Default hidden */
            position: fixed; bottom: 0; left: 0; right: 0; height: 70px;
            background: white; box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
            justify-content: space-around; align-items: center;
            z-index: 1050; padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-icon { text-align: center; color: #94a3b8; font-size: 0.75rem; cursor: pointer; flex: 1; transition: 0.2s; }
        .nav-icon i { font-size: 1.5rem; display: block; margin-bottom: 4px; }
        .nav-icon.active { color: var(--primary); transform: scale(1.1); font-weight: bold; }

        /* Cart Bar */
        #cart-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #0f172a; color: white; padding: 15px 25px; 
            z-index: 1040; transform: translateY(150%); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 -5px 25px rgba(0,0,0,0.2);
        }
        #cart-bar.visible { transform: translateY(0); }
        
        /* Footer Styling */
        .main-footer {
            margin-top: auto;
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
            background-color: white;
        }

        /* --- Landing Page Styles (Centered & Clean) --- */
        .hero-section {
            background: linear-gradient(180deg, #0f172a 0%, #1e3a8a 100%);
            color: white;
            padding: 80px 0 100px;
            text-align: center; /* Center everything */
            position: relative;
            overflow: hidden;
        }
        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }
        .feature-card {
            background: white;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            height: 100%;
            border: 1px solid #f1f5f9;
            text-align: center;
        }
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        .feature-icon {
            width: 70px; height: 70px;
            background: #eff6ff;
            color: var(--primary);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem;
            margin: 0 auto 20px;
        }
        .contact-section {
            background: #f8f9fa;
            padding: 80px 0;
            text-align: center;
        }
        .landing-nav {
            position: absolute;
            top: 0; left: 0; right: 0;
            padding: 20px 0;
            z-index: 10;
        }

        /* Responsive Adjustments */
        @media (max-width: 991px) { /* Mobile & Tablet */
            .desktop-nav-content { display: none !important; }
            .bottom-nav { display: flex; }
            body { padding-bottom: 90px; } /* Space for bottom nav */
            #cart-bar { bottom: 70px; border-radius: 15px 15px 0 0; }
            .chart-container { height: 200px; }
            .main-footer { padding-bottom: 80px; } /* Lift footer above mobile nav */
        }
        @media (min-width: 992px) { /* Desktop */
            .mobile-header { display: none !important; }
        }

        .abc-badge-A { background: #dcfce7; color: #15803d; padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .abc-badge-B { background: #fef9c3; color: #a16207; padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .abc-badge-C { background: #fee2e2; color: #b91c1c; padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .auth-container { max-width: 450px; margin: 80px auto; }
        
        /* Settings Image Preview */
        .logo-preview { width: 100px; height: 100px; object-fit: contain; border: 2px dashed #ccc; border-radius: 10px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; }
    </style>
</head>
<body>

    <div id="landing-section">
        <div class="landing-nav">
            <div class="container d-flex justify-content-between align-items-center">
                <div class="fw-bold fs-4 text-white">SmartStock</div>
                <button class="btn btn-light text-primary fw-bold rounded-pill px-4" onclick="goToAuth()">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
            </div>
        </div>

        <header class="hero-section">
            <div class="container hero-content">
                <h1 class="display-3 fw-bold mb-4">× ×™×”×•×œ ×”×¢×¡×§ ×©×œ×š,<br>×—×›× ×•×¤×©×•×˜ ×™×•×ª×¨.</h1>
                <p class="lead mb-5 text-white-50 mx-auto" style="max-width: 600px;">
                    ××¢×¨×›×ª ×”-All-in-One ×œ× ×™×”×•×œ ××œ××™, ×œ×§×•×—×•×ª, ××›×™×¨×•×ª ×•×‘×™× ×” ××œ××›×•×ª×™×ª.<br>
                    ×”×¤×ª×¨×•×Ÿ ×”××•×©×œ× ×œ×¢×¡×§×™× ×§×˜× ×™× ×•×‘×™× ×•× ×™×™× ×©×¨×•×¦×™× ×œ×¦××•×—.
                </p>
                <div class="d-flex gap-3 justify-content-center mb-5">
                    <button class="btn btn-primary btn-lg px-5 py-3 rounded-pill fw-bold shadow-lg" onclick="goToAuth()">×”×ª×—×œ ×¢×›×©×™×• ×‘×—×™× × <i class="fas fa-arrow-left ms-2"></i></button>
                    <button class="btn btn-outline-light btn-lg px-4 py-3 rounded-pill fw-bold" onclick="document.getElementById('features').scrollIntoView({behavior: 'smooth'})">××™×š ×–×” ×¢×•×‘×“?</button>
                </div>
                
                <img src="https://cdni.iconscout.com/illustration/premium/thumb/business-dashboard-4500958-3734608.png" 
                     class="img-fluid rounded-4 shadow-lg" 
                     style="max-width: 80%; border: 1px solid rgba(255,255,255,0.1); filter: drop-shadow(0 20px 50px rgba(0,0,0,0.3));">
            </div>
        </header>

        <section id="features" class="py-5" style="background: white;">
            <div class="container py-5">
                <div class="text-center mb-5">
                    <h2 class="fw-bold display-6">×›×œ ××” ×©×”×¢×¡×§ ×¦×¨×™×š ×‘××§×•× ××—×“</h2>
                    <p class="text-muted">×‘× ×™× ×• ××ª SmartStock ×›×“×™ ×œ×—×¡×•×š ×œ×š ×–××Ÿ ×•×›×¡×£ ××”×™×•× ×”×¨××©×•×Ÿ</p>
                </div>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="feature-card">
                            <div class="feature-icon"><i class="fas fa-boxes"></i></div>
                            <h4>× ×™×”×•×œ ××œ××™ ×—×›×</h4>
                            <p class="text-muted">××¢×§×‘ ×‘×–××Ÿ ×××ª ××—×¨×™ ××•×¦×¨×™×, ×”×ª×¨××•×ª ××œ××™ × ××•×š ×•× ×™×”×•×œ ×¡×¤×§×™× ×‘×§×œ×™×§ ××—×“.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-card">
                            <div class="feature-icon"><i class="fas fa-magic"></i></div>
                            <h4>×“×•×—×•×ª AI ××ª×§×“××™×</h4>
                            <p class="text-muted">× ×™×ª×•×— ××•×˜×•××˜×™ ×©×œ ×”××›×™×¨×•×ª, ×ª×—×–×™×•×ª ×’××¨ ××œ××™ ×•×–×™×”×•×™ ××•×¦×¨×™× ×¨×•×•×—×™×™× (ABC Analysis).</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-card">
                            <div class="feature-icon"><i class="fas fa-cash-register"></i></div>
                            <h4>×§×•×¤×” ×•×œ×§×•×—×•×ª</h4>
                            <p class="text-muted">×§×•×¤×” ××”×™×¨×”, ×”×¤×§×ª ×§×‘×œ×•×ª ×‘×•×•××˜×¡××¤ ×•× ×™×”×•×œ ×›×¨×˜×¡×ª ×œ×§×•×—×•×ª ××œ××” (CRM).</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="contact-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-6 text-center">
                        <h2 class="fw-bold mb-3">×™×© ×œ×š ×©××œ×”? ×× ×—× ×• ×›××Ÿ.</h2>
                        <p class="text-muted mb-4">×”×©××¨ ×¤×¨×˜×™× ×•× ×—×–×•×¨ ××œ×™×š ×‘×”×§×“× ×¢× ×”×“×’××” ××™×©×™×ª.</p>
                        
                        <div class="p-4 bg-white rounded-4 shadow-sm border text-center">
                            <div class="mb-3">
                                <label class="form-label fw-bold w-100 text-start">×©× ××œ×</label>
                                <input type="text" id="contact-name" class="form-control" placeholder="×™×©×¨××œ ×™×©×¨××œ×™">
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold w-100 text-start">×˜×œ×¤×•×Ÿ</label>
                                <input type="tel" id="contact-phone" class="form-control" placeholder="050-0000000">
                            </div>
                            <button class="btn btn-dark w-100 py-3 fw-bold rounded-3" onclick="sendContact()">×¦×•×¨ ×§×©×¨</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="main-footer" style="background: #fff; border-top: 1px solid #eee;">
            <div class="container">
                <p class="m-0 fw-bold">×¢×•×¦×‘ ×•×¤×•×ª×— ×¢×œ ×™×“×™ ×œ×™××•×¨ ×§×™××” - × ×™×”×•×œ ××¢×¨×›×•×ª ××ª×§×“××•×ª ğŸš€</p>
                <small class="text-muted">Â© 2026 SmartStock</small>
            </div>
        </footer>
    </div>

    <div id="auth-section" class="container auth-container d-none">
        <button class="btn btn-sm btn-light position-absolute top-0 end-0 m-3" onclick="showLanding()"><i class="fas fa-times"></i></button>
        <div class="stat-card p-5 text-center">
            <div class="mb-4 text-primary" style="font-size: 3rem;"><i class="fas fa-cubes"></i></div>
            <h2 class="fw-bold mb-4">SmartStock</h2>
            
            <ul class="nav nav-pills nav-fill mb-4 p-1 bg-light rounded-pill">
                <li class="nav-item"><a class="nav-link rounded-pill active" onclick="toggleAuth('login')" href="#">×›× ×™×¡×”</a></li>
                <li class="nav-item"><a class="nav-link rounded-pill" onclick="toggleAuth('register')" href="#">×”×¨×©××”</a></li>
            </ul>
            
            <div id="form-login">
                <div class="form-floating mb-3">
                    <input type="email" id="l-email" class="form-control" placeholder="name@example.com">
                    <label>××™××™×™×œ</label>
                </div>
                <div class="form-floating mb-4">
                    <input type="password" id="l-pass" class="form-control" placeholder="Password">
                    <label>×¡×™×¡××”</label>
                </div>
                <button class="btn btn-primary w-100 py-3 fw-bold rounded-pill" onclick="login()">×”×ª×—×‘×¨ ×œ××¢×¨×›×ª <i class="fas fa-arrow-left me-2"></i></button>
            </div>
            
            <div id="form-register" class="d-none">
                <div class="form-floating mb-3">
                    <input type="text" id="r-name" class="form-control" placeholder="Business Name">
                    <label>×©× ×”×¢×¡×§</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="email" id="r-email" class="form-control" placeholder="name@example.com">
                    <label>××™××™×™×œ</label>
                </div>
                <div class="form-floating mb-4">
                    <input type="password" id="r-pass" class="form-control" placeholder="Password">
                    <label>×¡×™×¡××”</label>
                </div>
                <button class="btn btn-success w-100 py-3 fw-bold rounded-pill" onclick="register()">×¦×•×¨ ×—×©×‘×•×Ÿ <i class="fas fa-check me-2"></i></button>
            </div>
            <p id="auth-msg" class="text-center mt-3 fw-bold"></p>
        </div>
    </div>

    <div id="app-section" class="d-none flex-column h-100 w-100">
        
        <nav class="navbar navbar-expand-lg navbar-dark sticky-top mb-4">
            <div class="container">
                <a class="navbar-brand fw-bold fs-4 d-flex align-items-center gap-2" href="#">
                    <img id="nav-logo" src="https://cdn-icons-png.flaticon.com/512/2897/2897785.png" style="width:30px;height:30px;background:white;padding:2px;border-radius:6px;">
                    SmartStock
                </a>
                
                <div class="desktop-nav-content d-flex align-items-center">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" onclick="switchTab('dashboard')" id="nav-d-dashboard"><i class="fas fa-home"></i> ×“×©×‘×•×¨×“</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('analytics')" id="nav-d-analytics"><i class="fas fa-chart-pie"></i> ×“×•×—×•×ª AI</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('customers')" id="nav-d-customers"><i class="fas fa-users"></i> ×œ×§×•×—×•×ª</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('orders')" id="nav-d-orders"><i class="fas fa-receipt"></i> ×”×–×× ×•×ª</a></li>
                        <li class="nav-item"><a class="nav-link" onclick="switchTab('profile')" id="nav-d-profile"><i class="fas fa-cog"></i> ×”×’×“×¨×•×ª</a></li>
                    </ul>
                    <button class="btn btn-light text-primary fw-bold ms-3 rounded-pill px-4" onclick="logout()">×™×¦×™××”</button>
                </div>

                <div class="mobile-header d-lg-none ms-auto text-white">
                    <button class="btn btn-sm text-white" onclick="logout()"><i class="fas fa-sign-out-alt fs-5"></i></button>
                </div>
            </div>
        </nav>

        <div class="container flex-grow-1">
            
            <div id="tab-dashboard">
                <div class="row g-3 mb-4">
                    <div class="col-6 col-md-3"><div class="stat-card border-start border-4 border-primary"><div class="text-muted small fw-bold">××›×™×¨×•×ª ×”×™×•×</div><h3 class="fw-bold m-0 mt-1 text-primary" id="kpi-sales">â‚ª0</h3></div></div>
                    <div class="col-6 col-md-3"><div class="stat-card border-start border-4 border-success"><div class="text-muted small fw-bold">×¨×•×•×— ×ª×¤×¢×•×œ×™</div><h3 class="fw-bold m-0 mt-1 text-success" id="kpi-profit">â‚ª0</h3></div></div>
                    <div class="col-6 col-md-3"><div class="stat-card border-start border-4 border-info"><div class="text-muted small fw-bold">×©×•×•×™ ××œ××™</div><h3 class="fw-bold m-0 mt-1 text-info" id="kpi-stock-val">â‚ª0</h3></div></div>
                    <div class="col-6 col-md-3"><div class="stat-card border-start border-4 border-warning"><div class="text-muted small fw-bold">××œ××™ × ××•×š</div><h3 class="fw-bold m-0 mt-1 text-danger" id="kpi-low-stock">0</h3></div></div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-lg-8">
                        <div class="stat-card">
                            <h6 class="fw-bold mb-3"><i class="fas fa-chart-bar text-primary"></i> ××›×™×¨×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”</h6>
                            <div class="chart-container"><canvas id="chartCategories"></canvas></div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="stat-card">
                            <h6 class="fw-bold mb-3"><i class="fas fa-chart-pie text-success"></i> ×”×ª×¤×œ×’×•×ª ×¡×¤×§×™×</h6>
                            <div class="chart-container"><canvas id="chartSuppliers"></canvas></div>
                        </div>
                    </div>
                </div>

                <div class="stat-card p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold m-0"><i class="fas fa-cash-register"></i> ×§×•×¤×” ×•× ×™×”×•×œ ××•×¦×¨×™×</h5>
                        <div class="d-none d-md-block">
                            <button class="btn btn-outline-secondary" onclick="openCategoriesModal()">× ×™×”×•×œ ×§×˜×’×•×¨×™×•×ª</button>
                            <button class="btn btn-primary px-4" onclick="openProdModal()">+ ××•×¦×¨ ×—×“×©</button>
                        </div>
                        <div class="d-md-none"><button class="btn btn-primary btn-sm" onclick="openProdModal()">+ ×—×“×©</button></div>
                    </div>

                    <div class="input-group mb-3 shadow-sm">
                        <span class="input-group-text bg-white border-end-0" onclick="startScanner()" style="cursor:pointer"><i class="fas fa-barcode text-dark fs-5"></i></span>
                        <input type="text" id="search" class="form-control border-start-0 py-2" placeholder="×¡×¨×•×§ ×‘×¨×§×•×“ ××• ×—×¤×© ×©× ××•×¦×¨..." onkeyup="filterProds()">
                    </div>

                    <div class="table-responsive d-none d-md-block">
                        <table class="table table-hover align-middle">
                            <thead class="table-light"><tr><th>×©× ××•×¦×¨</th><th>×§×˜×’×•×¨×™×”</th><th>××—×™×¨</th><th>××œ××™</th><th>×¤×¢×•×œ×•×ª</th></tr></thead>
                            <tbody id="prod-table-desktop"></tbody>
                        </table>
                    </div>

                    <div class="row g-3 d-md-none" id="prod-grid-mobile"></div>
                </div>
            </div>

            <div id="tab-analytics" class="d-none">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="stat-card h-100">
                            <h5 class="fw-bold mb-3">ğŸ“Š × ×™×ª×•×— ABC (×¤××¨×˜×•)</h5>
                            <p class="small text-muted mb-3">×“×™×¨×•×’ ×”××•×¦×¨×™× ×œ×¤×™ ×ª×¨×•××” ×œ×”×›× ×¡×•×ª ×”×¢×¡×§ (A=×”×›×™ ×¨×•×•×—×™×™×)</p>
                            <div class="table-responsive">
                                <table class="table table-sm align-middle">
                                    <thead class="table-light"><tr><th>××•×¦×¨</th><th>×”×›× ×¡×•×ª</th><th>×“×™×¨×•×’</th></tr></thead>
                                    <tbody id="abc-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card h-100 border-top border-4 border-danger">
                            <h5 class="fw-bold mb-3 text-danger"><i class="fas fa-stopwatch"></i> ×ª×—×–×™×ª ×’××¨ ××œ××™</h5>
                            <p class="small text-muted mb-3">×”-AI ××–×”×” ××•×¦×¨×™× ×©×™×™×’××¨×• ×‘×§×¨×•×‘ ×œ×¤×™ ×§×¦×‘ ×”××›×™×¨×•×ª ×”× ×•×›×—×™</p>
                            <ul class="list-group list-group-flush" id="forecast-list"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-customers" class="d-none">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold">ğŸ‘¥ ×××’×¨ ×œ×§×•×—×•×ª</h5>
                        <button class="btn btn-success" onclick="openCustModal()"><i class="fas fa-user-plus"></i> ×œ×§×•×— ×—×“×©</button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light"><tr><th>×©×</th><th>×˜×œ×¤×•×Ÿ</th><th>×¢×¡×§</th><th>×¤×¢×•×œ×•×ª</th></tr></thead>
                            <tbody id="cust-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tab-orders" class="d-none">
                <div class="stat-card">
                    <h5 class="fw-bold mb-4">ğŸ“œ ×”×™×¡×˜×•×¨×™×™×ª ×”×–×× ×•×ª</h5>
                    <div class="list-group list-group-flush" id="order-list"></div>
                </div>
            </div>
            
            <div id="tab-profile" class="d-none">
                <div class="stat-card mx-auto" style="max-width:800px">
                    <div class="d-flex align-items-center gap-3 mb-4 border-bottom pb-3">
                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width:50px;height:50px;font-size:1.5rem">
                            <i class="fas fa-store"></i>
                        </div>
                        <div>
                            <h4 class="fw-bold m-0">×”×’×“×¨×•×ª ×¢×¡×§</h4>
                            <small class="text-muted">× ×™×”×•×œ ×¤×¨×˜×™ ×”×¢×¡×§ ×•×”× ×¨××•×ª ×‘×§×‘×œ×•×ª</small>
                        </div>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-12 col-md-6">
                            <label class="form-label fw-bold">×©× ×”×¢×¡×§</label>
                            <input type="text" id="prof-name" class="form-control">
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label fw-bold">×—.×¤ / ×ª.×–</label>
                            <input type="text" id="prof-tax-id" class="form-control" placeholder="×œ××©×œ: 512345678">
                        </div>
                        
                        <div class="col-12 col-md-6">
                            <label class="form-label fw-bold">×©× ××™×© ×§×©×¨</label>
                            <input type="text" id="prof-contact" class="form-control">
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label fw-bold">×˜×œ×¤×•×Ÿ ×œ×¢×¡×§×™×</label>
                            <input type="tel" id="prof-phone" class="form-control" dir="ltr">
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label fw-bold">×›×ª×•×‘×ª ××™×™×œ (×œ×§×‘×œ×•×ª)</label>
                            <input type="email" id="prof-email" class="form-control" dir="ltr">
                        </div>

                        <div class="col-12">
                            <label class="form-label fw-bold">×œ×•×’×• ×”×¢×¡×§</label>
                            <div class="d-flex gap-3 align-items-start">
                                <div class="logo-preview">
                                    <img id="prof-logo-preview" src="https://via.placeholder.com/100?text=Logo" style="max-width:100%;max-height:100%">
                                </div>
                                <div class="flex-grow-1">
                                    <input type="file" id="prof-logo-file" class="form-control mb-2" accept="image/*" onchange="convertLogo(this)">
                                    <small class="text-muted d-block">××•××œ×¥ ×œ×”×¢×œ×•×ª ×§×•×‘×¥ ××¨×•×‘×¢ (PNG/JPG)</small>
                                    <input type="hidden" id="prof-logo-b64">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 pt-3 border-top">
                        <button class="btn btn-primary w-100 py-2 fw-bold" onclick="saveProfile()"><i class="fas fa-save me-2"></i> ×©××•×¨ ×©×™× ×•×™×™×</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="main-footer">
            <div class="container">
                <p class="m-0 fw-bold">×¢×•×¦×‘ ×•×¤×•×ª×— ×¢×œ ×™×“×™ ×œ×™××•×¨ ×§×™××” - × ×™×”×•×œ ××¢×¨×›×•×ª ××ª×§×“××•×ª ğŸš€</p>
                <small class="text-muted">Â© 2026 SmartStock</small>
            </div>
        </footer>

        <div id="cart-bar">
            <div class="d-flex align-items-center gap-3">
                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width:40px;height:40px">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div>
                    <div class="fw-bold fs-5" id="cart-total">â‚ª0</div>
                    <div class="small opacity-75" id="cart-count">0 ×¤×¨×™×˜×™×</div>
                </div>
            </div>
            <button class="btn btn-light text-dark fw-bold px-4 rounded-pill shadow-sm" onclick="openCheckout()">×œ×§×•×¤×” <i class="fas fa-chevron-left ms-1"></i></button>
        </div>

        <div class="bottom-nav">
            <div class="nav-icon active" onclick="switchTab('dashboard')" id="btn-dashboard"><i class="fas fa-home"></i>×‘×™×ª</div>
            <div class="nav-icon" onclick="switchTab('analytics')" id="btn-analytics"><i class="fas fa-chart-line"></i>×“×•×—×•×ª</div>
            <div class="nav-icon" onclick="switchTab('orders')" id="btn-orders"><i class="fas fa-receipt"></i>×”×–×× ×•×ª</div>
            <div class="nav-icon" onclick="switchTab('customers')" id="btn-customers"><i class="fas fa-users"></i>×œ×§×•×—×•×ª</div>
        </div>
    </div>

    <div class="modal fade" id="scannerModal"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">×¡×¨×•×§ ×‘×¨×§×•×“</h5><button type="button" class="btn-close" data-bs-dismiss="modal" onclick="stopScanner()"></button></div><div class="modal-body p-0"><div id="reader" style="width: 100%;"></div></div></div></div></div>

    <div class="modal fade" id="checkoutModal"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title">×¡×’×™×¨×ª ×—×©×‘×•×Ÿ</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body">
        <div class="mb-3">
            <label class="form-label text-muted small fw-bold">×‘×—×¨ ×œ×§×•×—</label>
            <div class="input-group">
                <select id="co-cust" class="form-select"></select>
                <button class="btn btn-outline-secondary" onclick="openCustModal()">+ ×—×“×©</button>
            </div>
        </div>
        <div class="mb-4">
            <label class="form-label text-muted small fw-bold">×××¦×¢×™ ×ª×©×œ×•×</label>
            <div class="btn-group w-100" role="group">
                <input type="radio" class="btn-check" name="payment" id="pay-cash" value="××–×•××Ÿ" checked><label class="btn btn-outline-primary" for="pay-cash"><i class="fas fa-money-bill"></i> ××–×•××Ÿ</label>
                <input type="radio" class="btn-check" name="payment" id="pay-card" value="××©×¨××™"><label class="btn btn-outline-primary" for="pay-card"><i class="fas fa-credit-card"></i> ××©×¨××™</label>
                <input type="radio" class="btn-check" name="payment" id="pay-bit" value="Bit"><label class="btn btn-outline-primary" for="pay-bit"><i class="fab fa-btc"></i> Bit</label>
            </div>
        </div>
        <div class="card bg-light border-0 mb-3"><div class="card-body p-2"><ul class="list-group list-group-flush bg-transparent small" id="co-items"></ul></div></div>
        <div class="d-flex justify-content-between h4 fw-bold mt-3"><span>×¡×”"×› ×œ×ª×©×œ×•×:</span><span id="co-total" class="text-primary"></span></div>
        <button class="btn btn-success w-100 py-3 mt-3 fw-bold rounded-3 shadow-sm" onclick="submitOrder()">âœ… ×‘×¦×¢ ×”×–×× ×”</button>
    </div></div></div></div>

    <div class="modal fade" id="receiptModal"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-body text-center py-5">
        <div class="text-success mb-3" style="font-size: 4rem;"><i class="fas fa-check-circle"></i></div>
        <h3 class="fw-bold">×”×–×× ×” ×‘×•×¦×¢×” ×‘×”×¦×œ×—×”!</h3>
        <p class="text-muted mb-4">××¡×¤×¨ ×”×–×× ×”: <span id="rec-oid" class="fw-bold text-dark"></span></p>
        <button class="btn btn-success w-100 mb-2 py-2 fw-bold" onclick="shareWhatsApp()"><i class="fab fa-whatsapp me-2"></i> ×©×œ×— ×§×‘×œ×” ×œ×œ×§×•×—</button>
        <button class="btn btn-outline-secondary w-100 py-2" data-bs-dismiss="modal">×¡×’×•×¨</button>
    </div></div></div></div>

    <div class="modal fade" id="prodModal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">××•×¦×¨ ×—×“×©</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
        <input type="text" id="p-name" class="form-control mb-3" placeholder="×©× ×”××•×¦×¨">
        <div class="input-group mb-3">
             <span class="input-group-text"><i class="fas fa-barcode"></i></span>
             <input type="text" id="p-sku" class="form-control" placeholder="××§×´×˜ / ×‘×¨×§×•×“">
        </div>
        <div class="row g-2 mb-3">
            <div class="col"><div class="form-floating"><input type="number" id="p-price" class="form-control" placeholder="Price"><label>××›×™×¨×”</label></div></div>
            <div class="col"><div class="form-floating"><input type="number" id="p-cost" class="form-control" placeholder="Cost"><label>×¢×œ×•×ª</label></div></div>
        </div>
        <div class="form-floating mb-3"><input type="number" id="p-qty" class="form-control" placeholder="Qty"><label>×›××•×ª ×‘××œ××™</label></div>
        <div class="row g-2">
            <div class="col"><select id="p-cat" class="form-select"></select></div>
            <div class="col"><select id="p-sup" class="form-select"></select></div>
        </div>
        <button class="btn btn-primary w-100 mt-4 py-2 fw-bold" onclick="saveProd()">×©××•×¨ ××•×¦×¨</button>
    </div></div></div></div>

    <div class="modal fade" id="custModal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="custModalTitle">×œ×§×•×— ×—×“×©</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
        <input type="hidden" id="c-id"> <div class="mb-3">
            <label class="form-label">×©× ××œ×</label>
            <input type="text" id="c-name" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">×˜×œ×¤×•×Ÿ</label>
            <input type="tel" id="c-phone" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">×©× ×”×¢×¡×§ (××•×¤×¦×™×•× ×œ×™)</label>
            <input type="text" id="c-biz" class="form-control">
        </div>
        <button class="btn btn-success w-100 fw-bold" onclick="saveCust()">×©××•×¨ ×œ×§×•×—</button>
    </div></div></div></div>
    
    <div class="modal fade" id="catModal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">×§×˜×’×•×¨×™×•×ª</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="input-group mb-3"><input type="text" id="new-cat" class="form-control"><button class="btn btn-primary" onclick="addCat()">+</button></div><ul id="cat-list-manage" class="list-group list-group-flush"></ul></div></div></div></div>

    <div class="modal fade" id="orderItemsModal"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">×¤×¨×˜×™ ×”×–×× ×” #<span id="oi-id"></span></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body p-0"><ul class="list-group list-group-flush" id="oi-list"></ul></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --------------- CONFIG ---------------
        const API = "https://smartstock-mag6.onrender.com"; 
        // --------------------------------------

        let token = localStorage.getItem('token'), prods=[], custs=[], cats=[], sups=[], cart={}, lastOrder={}, charts={};
        let html5QrcodeScanner;

        // ** ×œ×•×’×™×§×” ×—×“×©×” ×œ×‘×“×™×§×ª ×”×ª×—×‘×¨×•×ª ××• ×”×¦×’×ª ×“×£ × ×—×™×ª×” **
        checkAuth();
        
        function checkAuth() {
            if (token) {
                // ×× ×™×© ×˜×•×§×Ÿ ×©××•×¨ - ×“×œ×’ ×™×©×™×¨×•×ª ×œ××¤×œ×™×§×¦×™×”
                init();
            } else {
                // ××—×¨×ª - ×•×•×“× ×©×“×£ ×”× ×—×™×ª×” ××•×¦×’
                showLanding();
            }
        }

        function showLanding() {
            document.getElementById('landing-section').classList.remove('d-none');
            document.getElementById('auth-section').classList.add('d-none');
            document.getElementById('app-section').classList.add('d-none');
        }

        function goToAuth() {
            document.getElementById('landing-section').classList.add('d-none');
            document.getElementById('auth-section').classList.remove('d-none');
        }
        
        function sendContact() {
            const name = document.getElementById('contact-name').value;
            const phone = document.getElementById('contact-phone').value;
            if(!name || !phone) return alert('× × ×œ××œ× ×©× ×•×˜×œ×¤×•×Ÿ');
            
            // ×¡×™××•×œ×¦×™×” ×©×œ ×©×œ×™×—×ª ×˜×•×¤×¡
            alert('×ª×•×“×” ' + name + '! ×”×”×•×“×¢×” × ×©×œ×—×” ×‘×”×¦×œ×—×”, × ×—×–×•×¨ ××œ×™×š ×œ××¡×¤×¨ ' + phone);
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-phone').value = '';
        }

        function toggleAuth(type) {
            document.getElementById('form-login').classList.toggle('d-none', type!=='login');
            document.getElementById('form-register').classList.toggle('d-none', type!=='register');
            document.querySelectorAll('.nav-pills .nav-link').forEach(l => l.classList.toggle('active'));
        }

        async function login() {
            const btn = document.querySelector('#form-login button'); btn.disabled=true; btn.innerHTML='××ª×—×‘×¨...';
            const res = await fetch(`${API}/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email:document.getElementById('l-email').value,password:document.getElementById('l-pass').value})});
            const d = await res.json();
            btn.disabled=false; btn.innerHTML='×”×ª×—×‘×¨ ×œ××¢×¨×›×ª';
            if(res.ok) { localStorage.setItem('token', d.access_token); token=d.access_token; init(); }
            else document.getElementById('auth-msg').innerText = d.error;
        }

        async function register() {
            const res = await fetch(`${API}/register`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email:document.getElementById('r-email').value,password:document.getElementById('r-pass').value, business_name:document.getElementById('r-name').value})});
            if(res.ok) { alert('× ×¨×©××ª ×‘×”×¦×œ×—×”! ×”×ª×—×‘×¨ ×›×¢×ª.'); toggleAuth('login'); }
            else document.getElementById('auth-msg').innerText = "×©×’×™××” ×‘×”×¨×©××”";
        }

        async function init() {
            // ×”×¡×ª×¨×ª ×“×¤×™ × ×—×™×ª×” ×•×”×ª×—×‘×¨×•×ª
            document.getElementById('landing-section').classList.add('d-none');
            document.getElementById('auth-section').classList.add('d-none');
            
            // ×”×¦×’×ª ×”××¤×œ×™×§×¦×™×”
            document.getElementById('app-section').classList.remove('d-none');
            document.getElementById('app-section').classList.add('d-flex');
            await loadData();
            loadProfileData(); 
        }

        async function loadData() {
            const headers = {'Authorization':token};
            const [pRes, cRes, sRes, catRes, supRes] = await Promise.all([
                fetch(`${API}/products`, {headers}), fetch(`${API}/customers`, {headers}), fetch(`${API}/stats`, {headers}),
                fetch(`${API}/categories`, {headers}), fetch(`${API}/suppliers`, {headers})
            ]);
            
            prods = await pRes.json(); custs = await cRes.json(); const stats = await sRes.json();
            cats = await catRes.json(); sups = await supRes.json();
            
            document.getElementById('kpi-sales').innerText = "â‚ª" + stats.total_sales.toLocaleString();
            document.getElementById('kpi-profit').innerText = "â‚ª" + stats.total_profit.toLocaleString();
            document.getElementById('kpi-stock-val').innerText = "â‚ª" + stats.total_value.toLocaleString();
            document.getElementById('kpi-low-stock').innerText = stats.low_stock;
            
            renderProds(prods);
            renderCharts(prods);
            fillSelects();
        }

        function renderProds(list) {
            document.getElementById('prod-table-desktop').innerHTML = list.map(p => `
                <tr>
                    <td><div class="fw-bold">${p.name}</div><div class="small text-muted">${p.sku||'-'}</div></td>
                    <td><span class="badge bg-light text-dark border">${cats.find(c=>c.id==p.category_id)?.name||'-'}</span></td>
                    <td class="fw-bold text-primary">â‚ª${p.sell_price}</td>
                    <td>${p.quantity}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3" onclick="addCart(${p.id})">+ ×”×•×¡×£</button>
                        <i class="fas fa-pen text-muted ms-2" style="cursor:pointer" onclick="editProd(${p.id})"></i>
                    </td>
                </tr>
            `).join('');

            document.getElementById('prod-grid-mobile').innerHTML = list.map(p => `
                <div class="col-12">
                    <div class="stat-card p-3 d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold text-dark">${p.name}</div>
                            <div class="d-flex align-items-center gap-2 mt-1">
                                <span class="badge bg-light text-dark border">${cats.find(c=>c.id==p.category_id)?.name||'-'}</span>
                                <span class="small text-muted">××œ××™: ${p.quantity}</span>
                            </div>
                            <div class="text-primary fw-bold mt-1">â‚ª${p.sell_price}</div>
                        </div>
                        <button class="btn btn-primary rounded-circle shadow-sm" style="width:45px;height:45px" onclick="addCart(${p.id})"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function renderCharts(products) {
            const catCounts = {};
            products.forEach(p => { const c = cats.find(x=>x.id==p.category_id)?.name||'××—×¨'; catCounts[c]=(catCounts[c]||0)+1; });
            drawChart('chartCategories', 'bar', Object.keys(catCounts), Object.values(catCounts), '#3b82f6');

            const supCounts = {};
            products.forEach(p => { const s = sups.find(x=>x.id==p.supplier_id)?.name||'××—×¨'; supCounts[s]=(supCounts[s]||0)+1; });
            drawChart('chartSuppliers', 'doughnut', Object.keys(supCounts), Object.values(supCounts), ['#3b82f6','#10b981','#f59e0b','#ef4444']);
        }

        function drawChart(id, type, labels, data, colors) {
            const ctx = document.getElementById(id).getContext('2d');
            if(charts[id]) charts[id].destroy();
            charts[id] = new Chart(ctx, {
                type: type,
                data: { labels, datasets: [{ data, backgroundColor: colors, borderRadius: 5 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: type==='doughnut', position:'bottom' } }, scales: type==='bar'?{y:{beginAtZero:true, grid:{display:false}}, x:{grid:{display:false}}}:{} }
            });
        }

        function addCart(pid) {
            const p = prods.find(x=>x.id==pid);
            if(p.quantity <= (cart[pid]||0)) return alert('××™×Ÿ ××¡×¤×™×§ ××œ××™');
            cart[pid] = (cart[pid]||0)+1;
            renderCart();
        }

        function renderCart() {
            let total=0, count=0;
            for(let pid in cart) {
                const p = prods.find(x=>x.id==pid);
                total += p.sell_price * cart[pid];
                count += cart[pid];
            }
            document.getElementById('cart-total').innerText = "â‚ª" + total.toLocaleString();
            document.getElementById('cart-count').innerText = `${count} ×¤×¨×™×˜×™×`;
            document.getElementById('cart-bar').classList.toggle('visible', count>0);
        }

        function openCheckout() {
            const list = document.getElementById('co-items');
            list.innerHTML = '';
            let total=0;
            for(let pid in cart) {
                const p = prods.find(x=>x.id==pid);
                const sub = p.sell_price * cart[pid];
                total += sub;
                list.innerHTML += `<li class="list-group-item d-flex justify-content-between bg-transparent"><span>${p.name} x${cart[pid]}</span><span>â‚ª${sub}</span></li>`;
            }
            document.getElementById('co-total').innerText = "â‚ª" + total.toLocaleString();
            const sel = document.getElementById('co-cust');
            sel.innerHTML = '<option value="">×œ×œ× ×©×™×•×š (××–×“××Ÿ)</option>' + custs.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
            new bootstrap.Modal(document.getElementById('checkoutModal')).show();
        }

        async function submitOrder() {
            const custId = document.getElementById('co-cust').value;
            const payMethod = document.querySelector('input[name="payment"]:checked').value;
            const items = Object.keys(cart).map(pid => ({product_id: pid, quantity: cart[pid]}));
            
            const res = await fetch(`${API}/orders`, {
                method:'POST',
                headers:{'Content-Type':'application/json','Authorization':token},
                body:JSON.stringify({customer_id: custId, items: items, payment_method: payMethod})
            });

            if(res.ok) {
                const d = await res.json();
                lastOrder = { id: d.order_id, total: document.getElementById('co-total').innerText };
                cart={}; renderCart();
                bootstrap.Modal.getInstance(document.getElementById('checkoutModal')).hide();
                loadData(); 
                document.getElementById('rec-oid').innerText = d.order_id;
                new bootstrap.Modal(document.getElementById('receiptModal')).show();
            }
        }

        function startScanner() {
            new bootstrap.Modal(document.getElementById('scannerModal')).show();
            html5QrcodeScanner = new Html5Qrcode("reader");
            html5QrcodeScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 },
                (decodedText) => {
                    stopScanner();
                    const p = prods.find(x => x.sku === decodedText);
                    if(p) { addCart(p.id); alert(`× ×•×¡×£: ${p.name}`); } else alert('××•×¦×¨ ×œ× × ××¦×');
                    bootstrap.Modal.getInstance(document.getElementById('scannerModal')).hide();
                }
            ).catch(err => { alert('×”××¦×œ××” ×œ× ×–××™× ×”'); bootstrap.Modal.getInstance(document.getElementById('scannerModal')).hide(); });
        }
        function stopScanner() { if(html5QrcodeScanner) html5QrcodeScanner.stop().then(()=>html5QrcodeScanner.clear()); }

        async function switchTab(t) {
            ['dashboard','analytics','customers','orders','profile'].forEach(x => {
                document.getElementById('tab-'+x).classList.toggle('d-none', x!==t);
                
                const deskLink = document.getElementById('nav-d-'+x);
                if(deskLink) {
                     document.querySelectorAll('.desktop-nav-content .nav-link').forEach(l=>l.classList.remove('active'));
                     if(x===t) deskLink.classList.add('active');
                }

                const mobBtn = document.getElementById('btn-'+x);
                if(mobBtn) {
                    document.querySelectorAll('.bottom-nav .nav-icon').forEach(l=>l.classList.remove('active'));
                    if(x===t) mobBtn.classList.add('active');
                }
            });

            if(t==='analytics') loadAnalytics();
            if(t==='orders') loadOrders();
            if(t==='customers') renderCusts();
            if(t==='profile') loadProfileData();
        }

        async function loadAnalytics() {
            const res = await fetch(`${API}/analytics`, {headers:{'Authorization':token}});
            const d = await res.json();
            
            document.getElementById('abc-list').innerHTML = d.abc.map(x => 
                `<tr><td>${x.name}</td><td>â‚ª${x.revenue.toLocaleString()}</td><td><span class="abc-badge-${x.grade}">${x.grade}</span></td></tr>`
            ).join('');

            document.getElementById('forecast-list').innerHTML = d.forecast.map(x => 
                `<li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <div class="fw-bold">${x.name}</div>
                        <small class="text-muted">××œ××™ × ×•×›×—×™: ${x.stock}</small>
                    </div>
                    <div class="text-danger fw-bold text-end">
                        <div><i class="fas fa-exclamation-triangle"></i> ×™×™×’××¨ ×‘:</div>
                        <div>${x.days_left} ×™××™×</div>
                    </div>
                </li>`
            ).join('');
        }

        async function loadOrders() {
            const res = await fetch(`${API}/orders`, {headers:{'Authorization':token}});
            const list = await res.json();
            document.getElementById('order-list').innerHTML = list.map(o => `
                <div class="list-group-item p-3">
                    <div class="d-flex w-100 justify-content-between mb-2">
                        <h6 class="mb-1 fw-bold">×”×–×× ×” #${o.id}</h6>
                        <small class="text-muted">${new Date(o.created_at).toLocaleDateString()}</small>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="small">
                            <i class="fas fa-user text-secondary me-1"></i> ${o.customer_name || '×œ×§×•×— ××–×“××Ÿ'}
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="fw-bold text-primary">â‚ª${o.total_amount}</span>
                            <span class="badge bg-light text-dark border">${o.payment_method}</span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="viewOrder(${o.id})"><i class="fas fa-eye"></i></button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function viewOrder(oid) {
            document.getElementById('oi-id').innerText = oid;
            const res = await fetch(`${API}/orders/${oid}/items`, {headers:{'Authorization':token}});
            const items = await res.json();
            
            let html = '';
            if(!items || items.length === 0) {
                 html = '<li class="list-group-item p-3">×œ× × ××¦××• ×¤×¨×™×˜×™×</li>';
            } else {
                items.forEach(i => {
                    html += `<li class="list-group-item p-3 d-flex justify-content-between">
                        <div>
                            <div class="fw-bold">${i.product_name}</div>
                            <small class="text-muted">${i.quantity} ×™×—' x â‚ª${i.sell_price}</small>
                        </div>
                        <div class="fw-bold">â‚ª${i.quantity * i.sell_price}</div>
                    </li>`;
                });
            }
            document.getElementById('oi-list').innerHTML = html;
            new bootstrap.Modal(document.getElementById('orderItemsModal')).show();
        }

        function renderCusts() {
            document.getElementById('cust-list').innerHTML = custs.map(c => 
                `<tr>
                    <td>${c.name}</td>
                    <td><a href="tel:${c.phone}" class="text-decoration-none">${c.phone||'-'}</a></td>
                    <td>${c.business_name||'-'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editCust(${c.id})"><i class="fas fa-pen"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="delCust(${c.id})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`
            ).join('');
        }

        function editCust(cid) {
            const c = custs.find(x => x.id === cid);
            if(!c) return;
            document.getElementById('c-id').value = c.id;
            document.getElementById('c-name').value = c.name;
            document.getElementById('c-phone').value = c.phone || '';
            document.getElementById('c-biz').value = c.business_name || '';
            document.getElementById('custModalTitle').innerText = '×¢×¨×™×›×ª ×œ×§×•×—';
            new bootstrap.Modal(document.getElementById('custModal')).show();
        }
        
        function openCustModal(){ 
            document.getElementById('c-id').value = '';
            document.getElementById('c-name').value = '';
            document.getElementById('c-phone').value = '';
            document.getElementById('c-biz').value = '';
            document.getElementById('custModalTitle').innerText = '×œ×§×•×— ×—×“×©';
            new bootstrap.Modal(document.getElementById('custModal')).show(); 
        }

        function openProdModal(){ new bootstrap.Modal(document.getElementById('prodModal')).show(); }
        function openCategoriesModal(){ new bootstrap.Modal(document.getElementById('catModal')).show(); renderCatsManage(); }
        
        function fillSelects() {
            const catOpts = '<option value="">×‘×—×¨ ×§×˜×’×•×¨×™×”...</option>' + cats.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
            const supOpts = '<option value="">×‘×—×¨ ×¡×¤×§...</option>' + sups.map(s=>`<option value="${s.id}">${s.name}</option>`).join('');
            document.getElementById('p-cat').innerHTML = catOpts;
            document.getElementById('p-sup').innerHTML = supOpts;
        }

        async function saveProd(){
             const body={
                 name: document.getElementById('p-name').value,
                 sku: document.getElementById('p-sku').value,
                 sell_price: document.getElementById('p-price').value,
                 cost_price: document.getElementById('p-cost').value,
                 quantity: document.getElementById('p-qty').value,
                 category_id: document.getElementById('p-cat').value,
                 supplier_id: document.getElementById('p-sup').value
             };
             await fetch(`${API}/products`, {method:'POST',headers:{'Content-Type':'application/json','Authorization':token},body:JSON.stringify(body)});
             bootstrap.Modal.getInstance(document.getElementById('prodModal')).hide();
             loadData();
        }

        async function saveCust(){
            const cid = document.getElementById('c-id').value;
            const body = { 
                name: document.getElementById('c-name').value, 
                phone: document.getElementById('c-phone').value, 
                business_name: document.getElementById('c-biz').value 
            };
            
            let method = 'POST';
            let url = `${API}/customers`;
            
            if(cid) {
                method = 'PUT';
                url = `${API}/customers/${cid}`;
            }

            await fetch(url, {method: method, headers:{'Content-Type':'application/json','Authorization':token}, body:JSON.stringify(body)});
            bootstrap.Modal.getInstance(document.getElementById('custModal')).hide();
            const res = await fetch(`${API}/customers`, {headers:{'Authorization':token}}); custs = await res.json(); 
            switchTab('customers');
        }

        async function delCust(id) {
            if(!confirm('×œ××—×•×§ ×œ×§×•×— ×–×”?')) return;
            await fetch(`${API}/customers/${id}`, {method:'DELETE', headers:{'Authorization':token}});
            const res = await fetch(`${API}/customers`, {headers:{'Authorization':token}}); custs = await res.json(); 
            renderCusts();
        }

        function convertLogo(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('prof-logo-preview').src = e.target.result;
                    document.getElementById('prof-logo-b64').value = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function loadProfileData() {
            const res = await fetch(`${API}/profile`, {headers:{'Authorization':token}});
            const d = await res.json();
            
            document.getElementById('prof-name').value = d.business_name || '';
            document.getElementById('prof-tax-id').value = d.tax_id || '';
            document.getElementById('prof-contact').value = d.contact_name || '';
            document.getElementById('prof-phone').value = d.phone || '';
            document.getElementById('prof-email').value = d.email || '';
            
            if(d.logo_url && d.logo_url.startsWith('data:image')) {
                document.getElementById('prof-logo-preview').src = d.logo_url;
                document.getElementById('prof-logo-b64').value = d.logo_url;
                document.getElementById('nav-logo').src = d.logo_url;
            }
        }

        async function saveProfile(){
            const body = {
                business_name: document.getElementById('prof-name').value,
                tax_id: document.getElementById('prof-tax-id').value,
                contact_name: document.getElementById('prof-contact').value,
                phone: document.getElementById('prof-phone').value,
                email: document.getElementById('prof-email').value,
                logo_url: document.getElementById('prof-logo-b64').value
            };

            await fetch(`${API}/profile`, {method:'PUT',headers:{'Content-Type':'application/json','Authorization':token},body:JSON.stringify(body)});
            alert('×”×’×“×¨×•×ª × ×©××¨×• ×‘×”×¦×œ×—×”!');
            loadProfileData(); 
        }
        
        async function addCat() {
            const n = document.getElementById('new-cat').value;
            await fetch(`${API}/categories`, {method:'POST',headers:{'Content-Type':'application/json','Authorization':token},body:JSON.stringify({name:n})});
            document.getElementById('new-cat').value='';
            const r = await fetch(`${API}/categories`, {headers:{'Authorization':token}}); cats = await r.json();
            renderCatsManage(); fillSelects();
        }
        function renderCatsManage() { document.getElementById('cat-list-manage').innerHTML = cats.map(c=>`<li class="list-group-item">${c.name}</li>`).join(''); }

        function filterProds(){ renderProds(prods.filter(p=>p.name.includes(document.getElementById('search').value) || (p.sku && p.sku.includes(document.getElementById('search').value)))); }
        function shareWhatsApp() { window.open(`https://wa.me/?text=×§×‘×œ×” ×œ×”×–×× ×” ${lastOrder.id}: ×¡×”"×› ${lastOrder.total}`, '_blank'); }
        function logout(){ localStorage.clear(); location.reload(); }

    </script>
</body>
</html>
